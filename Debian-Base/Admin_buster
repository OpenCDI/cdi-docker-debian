ARG COSHAPP_BASE_VERSION
FROM coshapp/core:buster-${COSHAPP_BASE_VERSION:-10.7}

RUN apt-get install -y git curl jq
RUN apt-get install -y uidmap
RUN apt-get install -y docker.io
RUN apt-get clean all
RUN usermod -aG docker duser

RUN docker help version || exit 1

RUN mkdir -p /home/duser/local/shef
WORKDIR /home/duser/local/shef
RUN git config --global user.name saru
RUN git config --global user.email saru@localhost

RUN git clone https://github.com/okadash/shelib /home/duser/local/shelib
WORKDIR /home/duser/local/shelib
RUN ./install.sh || cp -av bin/shef /home/duser/.shef/bin 
ENV PATH=/home/duser/.shef/bin:$PATH

ENV EDITOR=/usr/bin/vi
RUN shef install https://github.com/okadash/cosh
RUN shef install https://github.com/okadash/nik

CMD /bin/sh
